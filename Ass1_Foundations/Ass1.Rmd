---
title: "Assignment 1"
author: 
- Erling Tenn√∏y Nordtvedt 
- Oleg Karpov
date: "2024-09-16"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#options(contrasts = c("contr.sum", "contr.poly"))
require("ggplot2")
require("dplyr")
```

## Exercise 1 - R syntax & data structures

### (a)
```{r E1_a}
gapminder <- read.csv("gapminder.csv")

summary(gapminder)
```

### (b)
``` {r E1_b}
gapminder %>%
  ggplot(aes(x=year, y=lifeExp, colour=continent)) +
    #geom_bar(position='dodge', stat='identity')
    geom_line()
```

### (c)
```{r E1_c}
knitr::kable(
  gapminder %>%
    group_by(continent, year) %>%
    summarise_at(vars(lifeExp), list(Min = min, Med = median, Mean = mean, Max = max, Sd = sd)) %>%
    data.frame()
)
```

### (d)
```{r E1_d}
gapminder %>%
  group_by(continent, year) %>%
  summarise(Mean_lifeExp= mean(lifeExp, na.rm = T), .groups = 'drop') %>%
  ggplot(aes(x=year, y=Mean_lifeExp)) +
  geom_ribbon(aes(ymin= Mean_lifeExp - 1, ymax = Mean_lifeExp + 1), fill = "grey70") +
  geom_line() +
  facet_grid(.~continent) +
  theme(axis.text.x = element_text(angle=90)) +
  ylim(0, NA)
```

## Exercise 2 - Elementary data analysis and model training

### (a)
```{r E2_a_1}
weatherHistory <- read.csv("weatherHistory.csv")
head(weatherHistory)
```
**Qualitative nominal**

* Summary
* Precip.Type
* Daily.Summary

**Quantitative Continuous:**

* Temperature..C.
* Apparent.Temperature..C.
* Humidity
* Wind.Speed..km.h.
* Visibility..km.
* Wind.Bearing..degrees (Reason: Not ranked)

**Quantitative Discrete:**

* Formatted.Date
* Loud.Cover

#### Qualitative nominal
``` {r E2_a_2}
weatherHistory %>%
  group_by(Precip.Type) %>%
  summarize(Count = n()) %>%
  ggplot(aes(x=Precip.Type, y=Count)) +
  geom_bar(stat='identity', position='dodge')
```


``` {r E2_a_3}
weatherHistory %>%
  group_by(Summary) %>%
  summarize(Count = n()) %>%
  ggplot(aes(x=Summary, y=Count)) +
  geom_bar(stat='identity', position='dodge') +
  theme(axis.text.x = element_text(angle=90))
```
``` {r E2_a_4}
weatherHistory %>%
  group_by(Daily.Summary) %>%
  summarize(Count = n()) %>%
  ggplot(aes(x=Daily.Summary, y=Count)) +
  geom_bar(stat='identity', position='dodge')
```


#### Discrete nominal
```{r E2_a_5}
weatherHistory %>%
  ggplot(aes(Temperature..C.)) +
  geom_histogram(aes(y = ..density..), fill = "white", color="black") +
  stat_density(kernel = "gaussian", fill = NA, colour = "black")
```


```{r E2_a_6}
weatherHistory %>%
  ggplot(aes(Apparent.Temperature..C.)) +
  geom_histogram(aes(y = ..density..), fill = "white", color="black") +
  stat_density(kernel = "gaussian", fill = NA, colour = "black")
```


```{r E2_a_7}
weatherHistory %>%
  ggplot(aes(Humidity)) +
  geom_histogram(aes(y = ..density..), fill = "white", color="black") +
  stat_density(kernel = "gaussian", fill = NA, colour = "black")
```
```{r E2_a_8}
weatherHistory %>%
  ggplot(aes(Wind.Speed..km.h.)) +
  geom_histogram(aes(y = ..density..), fill = "white", color="black") +
  stat_density(kernel = "gaussian", fill = NA, colour = "black")
```
```{r E2_a_9}
weatherHistory %>%
  ggplot(aes(Visibility..km.)) +
  geom_histogram(aes(y = ..density..), fill = "white", color="black") +
  stat_density(kernel = "gaussian", fill = NA, colour = "black")
```

``` {r E2_a_11}

# weatherHistory %>%
#   group_by(Wind.Bearing..degrees.) %>%
#   summarize(Count = n()) %>%
#   ggplot(aes(x=Wind.Bearing..degrees., y=Count)) +
#   geom_bar(stat='identity', position='dodge') +
#   theme(axis.text.x = element_text(angle=90))

weatherHistory %>%
  ggplot(aes(Wind.Bearing..degrees.)) +
  geom_histogram(aes(y = ..density..), fill = "white", color="black") +
  stat_density(kernel = "gaussian", fill = NA, colour = "black")
```

#### Quantative discrete
```{r E2_a_10}
weatherHistory %>%
  group_by(Loud.Cover) %>%
  summarize(Count = n()) %>%
  ggplot(aes(x=Loud.Cover, y=Count)) +
  geom_bar(stat='identity', position='dodge') +
  theme(axis.text.x = element_text(angle=90))
```

### (b)
First removing all columns that seem irrelevant, reasoning:

* Formatted.Date : When encoded it will be equal to row label (1, 2, 3, ...) which tells nothing
* Loud.Cover : All values are 0, therfore tells nothing
* Daily.Summary : Too big to onehotencode effectivly

Then remove all rows with NA, do this after removing irrelevant columns so data is not lost to having NA in the removed columns
```{r E2_b_1}
library(caret)
library(tidyr)
library(dplyr)
weatherHistory <- weatherHistory %>% select(-c("Formatted.Date", "Daily.Summary", "Loud.Cover"))
weatherHistory <- na.omit(weatherHistory) # Remove all NA
head(weatherHistory)
```

``` {r E2_b_2}

num_wH <- weatherHistory %>%
  select(-c("Summary", "Precip.Type")) 
num_stand_wH <- as.data.frame(sapply(num_wH, function(x) ((x-mean(x))/sd(x))))

qualitative_wH <- weatherHistory %>%
  select(c("Summary", "Precip.Type")) #Omitted "Formatted.Date","Daily.Summary"

# PT <- factor(qualitative_wH$Precip.Type)
# PT <- as.data.frame(model.matrix(~ Precip.Type - 1, PT))
# 
# FD <- factor(qualitative_wH$Summary)
# FD <- as.data.frame(model.matrix(~ f - Summary - 1, FD))

q1 <- table(1:nrow(weatherHistory), weatherHistory$Precip.Type) # as.data.frame.matrix(
q2 <- table(1:nrow(weatherHistory), weatherHistory$Summary)
q <- as.data.frame.matrix(cbind(q1, q2))
#head(merge(PT, FD))

#oh_weatherHistory <- dummyVars("~ .", data = qualitative_wH)
#oh_weatherHistory <- data.frame(predict(oh_weatherHistory, newdata = qualitative_wH))
#head(num_stand_wH)
cleaned_wH <- cbind(num_stand_wH, q)
head(cleaned_wH)

sample <- sample(c(T, F), nrow(cleaned_wH), replace=T, prob=c(0.75, 0.25))
test_wH <- cleaned_wH[!sample,]
train_wH <- cleaned_wH[sample,]
```
### (c)
Reason for choosen variables:

* Tempratrue (C) : Baseline that gets moved
* Humidity : Feels a lot hotter when its more humid, harder to sweat
* Wind speed : Wind makes skin feel colder
* Pressure : Pressure changes based on if it may rain or not, feels different
* Rain/Snow : If it rains the air feels colder

```{r E2_c_1}
wH_lm <- train_wH %>%
  lm(Apparent.Temperature..C. ~ rain + snow + Pressure..millibars. + Humidity + Temperature..C. + Wind.Speed..km.h., .)

summary.aov(wH_lm)
summary(wH_lm)
```
As can be seen an the ANOVA and t test for the different values, they are all significant within $\alpha \approx 0$ which means that there is almost 0 chance that the factors are due to random chance. (FIX LATER, DOUBBLE CHECK)
```{r E2_2_vals}
y_test_true <- test_wH$Apparent.Temperature..C.
y_test_pred <- predict(wH_lm, newdata = test_wH)
y_train_true <- train_wH$Apparent.Temperature..C.
y_train_pred <- predict(wH_lm, newdata = train_wH)
```

#### RMSE

$$ \text{RMSE}(y, \hat{y}) = \sqrt{\frac{\sum_{i=0}^{N - 1} (y_i - \hat{y}_i)^2}{N}} $$
```{r E2_c_2}
rmse_test <- RMSE(y_test_pred, y_test_true)
rmse_train <- RMSE(y_train_pred, y_train_true)
rmse_test
rmse_test

```
#### MAE
$$ \text{MAE}(x,y) = \sum_{i=1}^{D}|x_i-y_i|  $$
```{r E2_c_3}
mae_test <- MAE(y_test_pred, y_test_true)
mae_train <- MAE(y_train_pred, y_train_true)
mae_test
mae_train
```

#### $\text{R}^{2}$ score (coefficient of determination)
$$ 
R^2 = 1 - \frac{\text{SSR (sum of square regression)}}{\text{SST (total sum of squares)}} 
= 1 - \frac{\sum_{i=0}^{N - 1} (y_i - \hat{y}_i)^2}{\sum_{i=0}^{N - 1} (y_i - \hat{y})^2}
$$
```{r E2_c_4}
R2_test <- R2(y_test_pred, y_test_true)
R2_train <- R2(y_train_pred, y_train_true)
R2_test
R2_train
```

## Exercise 3 - Linear Regression and Diagnostic Plots


## Exercise 4 - correlation and partial correlation
